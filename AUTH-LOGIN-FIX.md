# 🔐 إصلاح مشكلة تسجيل الدخول

## المشكلة
المستخدم يسجل دخول بنجاح لكن يتم إرجاعه لنافذة تسجيل الدخول مرة أخرى.

## السبب
المشكلة تحدث لأن ملف المستخدم (`user_profiles`) غير موجود في قاعدة البيانات، رغم أن تسجيل الدخول في Supabase Auth ينجح.

## الحلول المتاحة

### الحل الأول: إصلاح شامل (مستحسن)
1. **افتح Supabase SQL Editor**
2. **انسخ محتوى ملف `fix-auth-issue.sql`**
3. **اضغط "Run"**
4. **انتظر رسائل النجاح**

### الحل الثاني: إنشاء مستخدمين تجريبيين
1. **انسخ محتوى ملف `create-test-user.sql`**
2. **اضغط "Run"**
3. **ثم اتبع الخطوات أدناه لإنشاء المستخدمين في Supabase Auth**

## إنشاء المستخدمين في Supabase Auth

### 1. إنشاء مستخدم مدير
1. اذهب إلى **Authentication** > **Users** في Supabase Dashboard
2. اضغط **"Add user"**
3. أدخل البيانات التالية:
   - **Email**: `admin@test.com`
   - **Password**: `123456`
   - **Auto Confirm User**: ✅ (مفعل)
4. اضغط **"Create user"**

### 2. إنشاء مستخدم عادي
1. اضغط **"Add user"** مرة أخرى
2. أدخل البيانات التالية:
   - **Email**: `user@test.com`
   - **Password**: `123456`
   - **Auto Confirm User**: ✅ (مفعل)
3. اضغط **"Create user"**

## اختبار الحل

### 1. اختبار تسجيل الدخول
1. افتح التطبيق
2. جرب تسجيل الدخول بـ:
   - **Email**: `admin@test.com`
   - **Password**: `123456`
3. يجب أن يتم توجيهك للوحة التحكم

### 2. التحقق من Console
افتح Developer Tools (F12) وتحقق من:
- عدم وجود أخطاء في Console
- ظهور رسائل نجاح تسجيل الدخول
- عدم ظهور رسائل خطأ متعلقة بـ `user_profiles`

## استكشاف الأخطاء

### إذا لم يعمل الحل:
1. **تحقق من وجود الجداول:**
   ```sql
   SELECT table_name FROM information_schema.tables 
   WHERE table_schema = 'public' AND table_name = 'user_profiles';
   ```

2. **تحقق من وجود المستخدمين:**
   ```sql
   SELECT * FROM user_profiles;
   ```

3. **تحقق من الـ Trigger:**
   ```sql
   SELECT * FROM information_schema.triggers 
   WHERE trigger_name = 'on_auth_user_created';
   ```

### إذا استمرت المشكلة:
1. تأكد من تنفيذ `clean-database-setup.sql` أولاً
2. تأكد من إنشاء المستخدمين في Supabase Auth
3. تحقق من متغيرات البيئة في ملف `.env`
4. تأكد من اتصال قاعدة البيانات

## ملاحظات مهمة
- ⚠️ **تأكد من إنشاء المستخدمين في Supabase Auth يدوياً**
- 🔒 **استخدم كلمات مرور قوية في الإنتاج**
- 📝 **احتفظ بنسخة احتياطية من البيانات المهمة**
- 🚀 **بعد الإصلاح، يمكنك إنشاء مستخدمين جدد من داخل التطبيق**

## بيانات الاختبار
- **المدير**: `admin@test.com` / `123456`
- **المستخدم**: `user@test.com` / `123456`
