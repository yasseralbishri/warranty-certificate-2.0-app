<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Client Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Supabase Client Test</h1>
    <p>This page tests if the Supabase client can be initialized correctly without the "headers undefined" error.</p>
    
    <div id="results"></div>
    
    <script type="module">
        const resultsDiv = document.getElementById('results');
        
        function addResult(type, title, message) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            resultsDiv.appendChild(div);
        }
        
        function addCodeResult(title, code) {
            const div = document.createElement('div');
            div.className = 'test-result info';
            div.innerHTML = `<strong>${title}</strong><pre>${code}</pre>`;
            resultsDiv.appendChild(div);
        }
        
        // Test 1: Check environment variables
        addResult('info', 'üîç Test 1: Environment Variables', 'Checking if VITE_ environment variables are available...');
        
        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;
        
        if (supabaseUrl && supabaseAnonKey) {
            addResult('success', '‚úÖ Environment Variables Found', 'Both VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY are available');
            addCodeResult('Environment Variables:', `URL: ${supabaseUrl}\nKey: ${supabaseAnonKey.substring(0, 20)}...`);
        } else {
            addResult('error', '‚ùå Environment Variables Missing', 'VITE_SUPABASE_URL or VITE_SUPABASE_ANON_KEY not found');
            return;
        }
        
        // Test 2: Import Supabase
        addResult('info', 'üîç Test 2: Supabase Import', 'Testing Supabase client import...');
        
        try {
            const { createClient } = await import('https://cdn.skypack.dev/@supabase/supabase-js@2');
            addResult('success', '‚úÖ Supabase Import Successful', 'Successfully imported createClient from @supabase/supabase-js');
            
            // Test 3: Create client
            addResult('info', 'üîç Test 3: Client Creation', 'Creating Supabase client...');
            
            const supabase = createClient(supabaseUrl, supabaseAnonKey, {
                auth: {
                    persistSession: true,
                    autoRefreshToken: true
                }
            });
            
            addResult('success', '‚úÖ Client Created Successfully', 'Supabase client created without "headers undefined" error');
            
            // Test 4: Test connection
            addResult('info', 'üîç Test 4: Connection Test', 'Testing connection to Supabase...');
            
            try {
                const { data, error } = await supabase.from('products').select('count').limit(1);
                
                if (error) {
                    addResult('error', '‚ùå Connection Error', `Error: ${error.message}`);
                } else {
                    addResult('success', '‚úÖ Connection Successful', 'Successfully connected to Supabase database');
                }
            } catch (connectionError) {
                addResult('error', '‚ùå Connection Failed', `Connection error: ${connectionError.message}`);
            }
            
        } catch (importError) {
            addResult('error', '‚ùå Import Failed', `Failed to import Supabase: ${importError.message}`);
        }
        
        // Test 5: Environment variable format validation
        addResult('info', 'üîç Test 5: Format Validation', 'Validating environment variable formats...');
        
        const urlValid = supabaseUrl.startsWith('https://') && supabaseUrl.includes('.supabase.co');
        const keyValid = supabaseAnonKey.startsWith('eyJ') || supabaseAnonKey.startsWith('sb_');
        
        if (urlValid && keyValid) {
            addResult('success', '‚úÖ Format Validation Passed', 'Both URL and key formats are valid');
        } else {
            addResult('error', '‚ùå Format Validation Failed', 
                `URL valid: ${urlValid}, Key valid: ${keyValid}`);
        }
        
        addResult('info', 'üéâ Test Complete', 'All tests completed. Check results above for any issues.');
        
    </script>
</body>
</html>
